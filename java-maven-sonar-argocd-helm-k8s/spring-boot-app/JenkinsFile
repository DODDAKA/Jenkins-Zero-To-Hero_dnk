pipeline {
    agent any
    environment {
        // Define ACR registry URL (replace with your ACR name)
        ACR_REGISTRY = "jenkinsacr.azurecr.io"
        // Jenkins credential ID for ACR credentials (stored in Jenkins)
        ACR_CREDENTIALS = "ACR_cred"
    }
    stages {
        stage('Checkout') {
            steps {
                // Use the credential ID for GitHub access
                sh 'echo passed'
            }
        }

        stage('Build and Test') {
            steps {
                sh 'ls -ltr'
                // build the project and create a JAR file
                sh 'cd java-maven-sonar-argocd-helm-k8s/spring-boot-app && mvn clean install'
            }
        }

        stage('Build Docker Image') {
            steps {
                script {
                    // Navigate to the directory containing the Dockerfile and build the image
                    sh '''
                        cd java-maven-sonar-argocd-helm-k8s/spring-boot-app
                        docker build -t ${ACR_REGISTRY}/my-spring-app:${env.BUILD_ID} .
                    '''
                }
            }
        }
    }
}
